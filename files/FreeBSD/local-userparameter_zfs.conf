# Managed by ansible (mit.zabbix-agent.zfs)
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
#
# ZFS discovery and configuration
# original template from pbergbolt (source = https://www.zabbix.com/forum/showthread.php?t=43347), modified by Slash <slash@aceslash.net>

# pool discovery
UserParameter=zfs.pool.discovery,PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin /opt/bin/zabbix-lld-zfs-pools
# fileset discovery
UserParameter=zfs.fileset.discovery,PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin /opt/bin/zabbix-lld-zfs-filesets

UserParameter=zfs.zpool.errors[*],zpool status -v $1 | egrep --after-context=99 "^errors: " | grep -v "No known data errors"

# Get any info from list, e.g.
# zfs.zpool.list[zroot,health]
UserParameter=zfs.zpool.list[*],zpool list -H -p -o $2 $1

# get capacy (percent) without percent (93 for 93%)
# We only need to escape the parameters from "$2" to "$$2" if the command has a 'flexible user parameter', e.g. [*]
# deprecated, use zfs.zpool.list
UserParameter=zfs.zpool.capacity[*],zpool list -H -o capacity $1 | tr -d '%'
UserParameter=zfs.zpool.health[*],zpool list -H -o health $1

# get any fs option
UserParameter=zfs.get.fsinfo[*],zfs get -o value -Hp $2 $1

# get any global zfs parameters
UserParameter=zfs.get.param[*],cat /sys/module/zfs/parameters/$1
